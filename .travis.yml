---
sudo: false
language: ruby
cache: bundler
bundler_args: --without system_tests development
before_install:
  - bundle -v
  - rm Gemfile.lock || true
  - gem update --system
  - gem update bundler
  - gem --version
  - bundle -v
script:
  - 'bundle exec rake $CHECK'
matrix:
  fast_finish: true
  include:
  - rvm: 2.1.9
    env: PUPPET_VERSION="~> 4.0" CHECK=test
  - rvm: 2.2.5
    env: PUPPET_VERSION="~> 4.0" CHECK=test
  - rvm: 2.3.1
    env: PUPPET_VERSION="~> 4.0" CHECK=build DEPLOY_TO_FORGE=yes
  - rvm: 2.3.1
    env: PUPPET_VERSION="~> 4.0" CHECK=rubocop
  - rvm: 2.3.1
    env: PUPPET_VERSION="~> 4.0" CHECK=test
  - rvm: 2.4.0-preview1
    env: PUPPET_VERSION="~> 4.0" CHECK=test
  allow_failures:
    - rvm: 2.4.0-preview1
notifications:
  email: false
deploy:
  provider: puppetforge
  deploy:
    branch: ha-bug-puppet-forge
  user: icann
  password:
    secure: "Z4xu/IFyEMe/7fPu7L609NggQO7aj8hcJvw+ALIZDzWAsovsbjfok20xitjdAEJfb63a9CIqL4GWKUtW0zwRr+Eo9JG/ti4YFSa2j/r4cayOohE4iQ4PnQeUhwoqROPPZhUnmpa9LO/6VNFJ+UcXtNK9xGSbp9awajRHco4ZPXA++efLgVMhqZoZJuC5WLCophRqsIb/bi4wY4+VPGKG0u5zFehoTUSf8ofZ+HrAvcKCVCkTYepbeok6zF+UFAXAEi/Ljq5ioeyk3LkTIFn/El+86OKH2yz0yCQk71zdDzuaKb1keyO7gYFel7OBzKIIcXlpkMsvAJA0BXAvkBTmAVXRY4faO01BYdQSoVFZUfpXlCvtSu0LRsFivgqFNFOf0FqVbRfy9fCUW0egLZSgwP1PYGF2PnOScOkU4pBv1DbCMzPOfkZlXYiR98wYI9sOYAHMC9ixAPhR9RKkFfE+KKVUfpzmvsG5oirgUTs2XzpsH+fnYEkXIVK5RKPBanyc55wj1k49EA2HCeTpDTOlL5b1aZdM0wKhIjQVmFV6UurmsyX8gEhqUd/0L060EEX7E6W6FZEIOx0Hm7VQt/sOKCEjil87KosYaKwJnMfBrhb49HTufRvuZxcbLHZ9FKTcG5fTidOqeMmBNwsB+bQqptG0bz7UVWqj2v8nouwHJpQ="
  on:
    tags: true
    # all_branches is required to use tags
    all_branches: true
    # Only publish the build marked with "DEPLOY_TO_FORGE"
    condition: "$DEPLOY_TO_FORGE = yes"
